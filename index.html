<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Carbon Budget Data Browser</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f9;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            color: #333;
            margin-top: 10px;
        }
        .intro-text {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            font-size: 1em;
            line-height: 1.5em;
            color: #333;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .intro-text a {
            color: #007bff;
            text-decoration: none;
        }
        .intro-text a:hover {
            text-decoration: underline;
        }
        #search-container {
            text-align: center;
            margin-bottom: 20px;
        }
        #search {
            width: 60%;
            padding: 0.5em;
            font-size: 1em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        #searchModeToggle {
            margin-left: 10px;
            padding: 0.5em;
            font-size: 1em;
            cursor: pointer;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #searchModeToggle:hover {
            background-color: #0056b3;
        }
        #fileTree {
            max-width: 800px;
            margin: auto;
            padding: 1em;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #downloadScript {
            display: block;
            width: 80%;
            margin: 1em auto;
            padding: 0.7em;
            font-size: 1em;
            cursor: pointer;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        #downloadScript:hover {
            background-color: #45a049;
        }
        .directory, .file-item {
            padding-left: 1.5em;
            font-size: 0.95em;
            margin: 0.2em 0;
        }
        .directory {
            cursor: pointer;
            color: #007bff;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            padding: 0.2em 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .file-item a {
            color: #333;
            text-decoration: none;
        }
        .file-item span {
            color: #666;
            font-size: 0.9em;
        }
        .collapsed > .sub-container {
            display: none;
        }
        .spinner {
            border: 4px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top: 4px solid #007bff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: block;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-63FP0FJM6N"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-63FP0FJM6N');
  
  function trackDownloadEvent() {
      gtag('event', 'download', {
          'event_category': 'Scripts',
          'event_label': 'wget_script',
          'value': 1
      });
  }
</script>
    
</head>
<body>
    <h1>Global Carbon Budget Data Browser</h1>
    
<div class="intro-text">
    <p>
        Welcome to the data hub for the land and ocean models behind the 
        <a href="https://globalcarbonbudget.org/" target="_blank">Global Carbon Budget</a> (GCB).
        Here you can browse and download the underlying model data.
    </p>

    <p>
        The global and country-level summary spreadsheets (carbon emissions and sinks) can be found on the GCB data hub 
        <a href="https://globalcarbonbudget.org/data-hub/the-latest-gcb-data/" target="_blank">here</a>.
    </p>

    <p>
        On this page, you will find land (TRENDY) and ocean model output from the current and 
        previous Global Carbon Budgets.
    </p>

    <h3>Terms of Data Use</h3>

    <h4>Land (TRENDY) and Ocean Data</h4>
    <p>
        Besides the net land sink and surface fCO₂ and air-sea CO₂ flux data that is made available open access, we provide additional output
        from the Dynamic Global Vegetation Models (DGVMs) that contribute to the TRENDY initiative, and from the Global Ocean Biogeochemical models and fCO₂ products
        (GCB-ocean).
        These data are freely available under the following data policy.
    </p>

    <p>
        Our main objective is to make all data available to the wider scientific community.
        For the most recent data set (<strong>TRENDY-GCB2025</strong> and <strong>ocean-GCB25</strong> used in Global Carbon Budget 2025),
        co-authorship of the contributing modellers depends on the importance of the TRENDY or GCB-ocean data in your study and must be discussed with the respective coordinators early in the process.
    </p>
    
    <p><strong>TRENDY coordinators:</strong></p>
    <ul>
       <li>Stephen Sitch – <a href="mailto:s.a.sitch@exeter.ac.uk">s.a.sitch@exeter.ac.uk</a></li>
       <li>Mike O’Sullivan – <a href="mailto:m.osullivan@exeter.ac.uk">m.osullivan@exeter.ac.uk</a></li>
    </ul>

    <p><strong>GCB-ocean coordinators:</strong></p>
    <ul>
       <li>Judith Hauck – <a href="mailto:judith.hauck@awi.de">judith.hauck@awi.de</a></li>
       <li>Peter Landschützer – <a href="mailto:peter.landschutzer@vliz.be">peter.landschutzer@vliz.be</a></li>
    </ul>

    <p>
        All studies should be circulated to the modelling groups prior to submission.
    </p>

    <p>
        If TRENDY-GCB2025 or GCB-ocean forms a significant part of a publication or conference presentation
        (whether or not it does will be a joint decision with the coordinators),
        the modelling groups and coordinators should be invited as co-authors, with sufficient lead time
        to allow meaningful input (minimum 3 weeks before submission; earlier engagement is encouraged).
    </p>

    <p>
        If TRENDY or GCB-ocean results are only a minor component (for example, a figure showing the multi-model mean mean),
        then it is sufficient to acknowledge the TRENDY or GCB-ocean projects (again, this should be agreed with the
        coordinators).
    </p>
    
    <p>
    Please cite the relevant references:
   </p>

   <ul>
    <li>
        TRENDY: Sitch et al., <em>Global Biogeochemical Cycles</em>, 2024, 
        <a href="https://doi.org/10.1029/2024GB008102" target="_blank">
        doi:10.1029/2024GB008102</a>
    </li>
    <li>
        The latest Global Carbon Budget paper 
        (<a href="https://globalcarbonbudget.org/" target="_blank">globalcarbonbudget.org</a>)
    </li>
   </ul>

    <p>
        For any issues or enquiries regarding this data browser, please contact
        Mike O'Sullivan – <a href="mailto:m.osullivan@exeter.ac.uk">m.osullivan@exeter.ac.uk</a>.
        <br>
        <em>Last update: November 2025.</em>
    </p>
</div>
    
    <div id="search-container">
        <input type="text" id="search" placeholder="Search files (e.g., 'trendyv10 nbp')" oninput="filterFiles()">
        <button id="searchModeToggle" onclick="toggleSearchMode()">Mode: Any</button>
    </div>
    <button id="downloadScript" onclick="generateWgetScript(); trackDownloadEvent();">Download wget Script for Searched Files</button>
    <div id="fileTree">
        <div class="spinner" id="loadingSpinner"></div>
    </div>

    <script>
        const sourceUrls = {
           aws: 'https://gcbo-opendata.s3.eu-west-2.amazonaws.com/',
           wasabi_land: 'https://s3.eu-west-1.wasabisys.com/gcb-2025-upload/land/output/',
           wasabi_ocean: 'https://s3.eu-west-1.wasabisys.com/gcb-2025-upload/ocean/output/'
        };

        function getSourceUrl(fileName) {
          // Files from Wasabi start with trendyv14-gcb2025/
          if (fileName.startsWith('trendyv14-gcb2025/')) {
            return sourceUrls.wasabi_land;
          }
          if (fileName.startsWith('ocean-GCB25/')) {
            return sourceUrls.wasabi_ocean;
          }
          return sourceUrls.aws;
        }

	const fileTree = document.getElementById('fileTree');
        const loadingSpinner = document.getElementById('loadingSpinner');
        let files = [];
        let filteredFiles = [];
        let searchMode = 'any'; // Default to "any" mode

        async function fetchFiles() {
            try {
                loadingSpinner.style.display = 'block';
                const response = await fetch('https://raw.githubusercontent.com/mdosullivan/GCB/main/fileIndex_merged.json');
                if (!response.ok) throw new Error('Could not fetch file index.');

                const fileList = await response.json();
                files = fileList.map(([name, size, lastModified]) => ({
                    name,
                    size: size ? `${(size / 1024).toFixed(1)} KB` : 'Unknown',
                    lastModified: lastModified || 'Unknown'
                }));

                renderFileTree(files);
            } catch (error) {
                console.error(error);
                fileTree.innerHTML = `<p>Error loading files: ${error.message}</p>`;
            } finally {
                loadingSpinner.style.display = 'none';
            }
        }

        function renderFileTree(fileList) {
            const root = {};
            filteredFiles = fileList;

            fileList.forEach(({ name }) => {
                const parts = name.split('/');
                let current = root;

                parts.forEach((part, i) => {
                    if (i === parts.length - 1) {
                        if (!current.files) current.files = [];
                        current.files.push(part);
                    } else {
                        if (!current[part]) current[part] = {};
                        current = current[part];
                    }
                });
            });

            fileTree.innerHTML = '';
            displayDirectoryIterative(root, fileTree);
        }

        function displayDirectoryIterative(structure, container) {
            const stack = [{ parent: container, node: structure, path: '' }];

            while (stack.length > 0) {
                const { parent, node, path } = stack.pop();
                for (const [key, value] of Object.entries(node)) {
                    if (key === 'files') {
                        value.forEach(file => {
                            let cleanPath = path + file;

                            // Remove trendyv14-gcb2025 prefix when building Wasabi links
                            if (cleanPath.startsWith('trendyv14-gcb2025/')) {
                              cleanPath = cleanPath.replace('trendyv14-gcb2025/', '');
                            }
                            if (cleanPath.startsWith('ocean-GCB25/')) {
                              cleanPath = cleanPath.replace('ocean-GCB25/', '');
                            }

                            // Build final full URL
                            const fullPath = `${getSourceUrl(path)}${cleanPath}`;
                            
                            const fileData = filteredFiles.find(f => f.name === `${path}${file}`);
                            const fileSize = fileData ? fileData.size : 'Unknown';
                            const fileModified = fileData ? fileData.lastModified : 'Unknown';

                            const fileDiv = document.createElement('div');
                            fileDiv.className = 'file-item';
                            fileDiv.innerHTML = `<a href="${fullPath}" target="_blank">${file}</a>
                                                 <span>${fileSize} | Last modified: ${fileModified}</span>`;
                            parent.appendChild(fileDiv);
                        });
                    } else {
                        const dirDiv = document.createElement('div');
                        dirDiv.className = 'directory collapsed';
                        dirDiv.textContent = key;
                        dirDiv.onclick = (event) => {
                            event.stopPropagation();
                            dirDiv.classList.toggle('collapsed');
                        };
                        parent.appendChild(dirDiv);

                        const subContainer = document.createElement('div');
                        subContainer.className = 'sub-container';
                        subContainer.style.paddingLeft = '1em';
                        dirDiv.appendChild(subContainer);
                        stack.push({ parent: subContainer, node: value, path: `${path}${key}/` });
                    }
                }
            }
        }

        function filterFiles() {
            const searchTerms = document.getElementById('search').value.toLowerCase().split(" ");
            filteredFiles = files.filter(({ name }) => {
                if (searchMode === 'any') {
                    return searchTerms.some(term => name.toLowerCase().includes(term));
                } else { // "all" mode
                    return searchTerms.every(term => name.toLowerCase().includes(term));
                }
            });
            renderFileTree(filteredFiles);
        }

        function toggleSearchMode() {
            searchMode = searchMode === 'any' ? 'all' : 'any';
            document.getElementById('searchModeToggle').textContent = `Mode: ${searchMode.charAt(0).toUpperCase() + searchMode.slice(1)}`;
            filterFiles(); // Re-run the filter with the new mode
        }

        function generateWgetScript() {
            if (filteredFiles.length === 0) {
                alert('No files to include in the script. Please search for files first.');
                return;
            }

            let scriptContent = '#!/bin/bash\n\n';
            filteredFiles.forEach(({ name }) => {
                const url = `${bucketUrl}/${name}`;
                scriptContent += `wget "${url}"\n`;
            });

            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'download_files.sh';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        fetchFiles();
    </script>
</body>
</html>
